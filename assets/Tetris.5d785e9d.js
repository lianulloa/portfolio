import{r as w,X as O,Y as b,Z as _,R as y,$ as T,m,j as u,a0 as N,V as k}from"./main.94ef72bb.js";const F={squares:[[1,1],[1,2],[2,0],[2,1]],color:"#41b883"},A={squares:[[1,1],[1,0],[2,2],[2,1]],color:"#00f1ff"},L={squares:[[1,1],[1,2],[1,0],[0,2]],color:"#e2c044"},D={squares:[[1,1],[1,2],[1,0],[0,0]],color:"#f46036"},M={squares:[[1,1],[1,2],[1,0],[0,1]],color:"#e75a7c"},W={squares:[[1,0],[1,1],[1,2],[1,3]],color:"#a288e3"},j={squares:[[1,1],[1,0],[0,0],[0,1]],color:"#f947ff"},G=[["i",[19,1]],["zed",[18,4]],["tee",[18,6],3],["ess",[18,9],1],["el",[18,7],1],["jay",[18,1]]],U=[[["i",[1,2]],["zed",[2,2]],["el",[3,4],3],["o",[2,6]],["tee",[0,8],1]],[["jay",[7,6]],["jay",[6,7],2],["ess",[5,9],1],["el",[8,8]],["tee",[7,4],3],["o",[10,2]]],[["ess",[12,4],1],["zed",[13,3]],["el",[11,6]],["o",[13,6]],["jay",[13,7],3],["tee",[15,5]],["i",[13,8],1]]],C=[[[.9,1.2],[1.8,2],[2.8,2.6]],[[5.9,4.2],[6.8,5.1],[7.8,7.6]],[[12,3.3],[12.9,3.5],[13.8,3.3]]];function z(){const h=[];for(const e of this.squares)h.push([e[1],2-e[0]]);return this.squares=h}class i{constructor(e,t,s=z){this.boardPosition=e,this.squares=t.squares,this.color=t.color,this.rotateClockwise=s}rotateCounterClockwise(){this.rotateClockwise(),this.rotateClockwise(),this.rotateClockwise()}static getOnBoardCoordinates(e,t){const s=[];for(const o of t){const r=[o[0]-1,o[1]-1];s.push([e[0]+r[0],e[1]+r[1]])}return s}static clone(e){return new i(e.boardPosition,{color:e.color,squares:e.squares})}getOnBoardCoordinates(){return i.getOnBoardCoordinates(this.boardPosition,this.squares)}getDownBoardPosition(){return[this.boardPosition[0]+1,this.boardPosition[1]]}getLeftBoardPosition(){return[this.boardPosition[0],this.boardPosition[1]-1]}getRightBoardPosition(){return[this.boardPosition[0],this.boardPosition[1]+1]}}function g(){return E(["ess","zed","el","jay","tee","i","o"][Math.floor(Math.random()*7)],[0,5])}function E(h,e){switch(h){case"ess":return new i(e,F);case"zed":return new i(e,A);case"el":return new i(e,L);case"jay":return new i(e,D);case"tee":return new i(e,M);case"i":return new i(e,W);case"o":return new i(e,j);default:throw new Error(`Piece [${h}] not supported`)}}const v="2",B="white",q=20,f=10,n={DOWN:"down",LEFT:"left",RIGHT:"right"},S={COUNTER:"counter",WISE:"wise"};class H{constructor(e,{setScore:t}){this.canvas=e,this.ctx=e.getContext("2d"),this.squareSide=e.height/q,this.board=Array.from({length:q},()=>Array(f).fill(!1)),this.piece=g(),this.pauseInterval=!1,this.score=0,this.setScore=t,this.gameInterval}drawBoard(){this.ctx.lineWidth=v,this.ctx.strokeStyle=B;for(let e=0;e<q;e++)for(let t=0;t<f;t++)this.ctx.strokeRect(t*this.squareSide,e*this.squareSide,this.squareSide,this.squareSide)}eraseBoard(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}drawTimeline(e){this.drawBaseTimeline();for(let t=0;t<3;t++){const s={font:`bold ${this.squareSide*.5}px 'Open Sans'`},{title:o,company:r,period:c}=e[t],l=U[t];for(const x of l)this.setupPiece(x),this.drawText(o,C[t][0],s),this.drawText(c,C[t][1],s),this.drawText(r,C[t][2],s)}}drawBaseTimeline(){for(const e of G)this.setupPiece(e);this.drawText("BSc. Computer Science",[18,.4]),this.drawText("at University of Havana",[18.9,.8])}setupPiece(e){const t=E(e[0],e[1]);if(e[2])for(let s=0;s<e[2];s++)t.rotateClockwise();this.drawPiece(t)}drawText(e,t,{font:s}={}){this.ctx.shadowColor="#444",this.ctx.shadowBlur=10,this.ctx.fillStyle=B,this.ctx.font=s||`bold ${this.squareSide*.7}px 'Open Sans'`,this.ctx.fillText(e,t[1]*this.squareSide,t[0]*this.squareSide+.8*this.squareSide),this.ctx.shadowColor="transparent"}startGame(){this.drawPiece(),this.gameInterval=setInterval(()=>{this.pauseInterval||this.handleMove(n.DOWN)||(this.persistPiece(),this.checkForFilledRows(),this.piece=g(),!this.handleMove(n.DOWN)&&(clearInterval(this.gameInterval),alert("You lose")))},600)}stopGame(){clearInterval(this.gameInterval)}drawPiece(e=this.piece){const t=e.getOnBoardCoordinates();for(const s of t)this._drawSquare(s,e.color)}clearPiece(){const e=this.piece.getOnBoardCoordinates();this._clearSquares(e)}persistPiece(e=this.piece){for(const t of e.getOnBoardCoordinates())this.board[t[0]][t[1]]=e.color}checkForFilledRows(e=this.piece){const t=[],s=new Set;let o=0;for(const r of e.getOnBoardCoordinates()){let c=!0;if(!s.has(r[0])){for(const l of this.board[r[0]])if(!l){c=!1;break}c&&(this.pauseInterval=!0,s.add(r[0]),r[0]>o&&(o=r[0]),t.push(this.clearRowFrom(r)))}}s.size&&(this.score+=s.size*100,this.setScore(this.score),Promise.all(t).then(()=>{this.board.splice(o-s.size+1,s.size);for(let r=0;r<s.size;r++)this.board.unshift(Array(f).fill(!1));for(let r=o;r>=0;r--)this._clearSquares(Array.from({length:f},(c,l)=>[r,l])),this.board[r].map((c,l)=>{c&&this._drawSquare([r,l],c)});this.pauseInterval=!1}))}handleMove(e){return this._canMoveTo(this.piece,e)?(this._movePiece(this.piece,e),!0):!1}handleRotation(e){if(this._canRotate(i.clone(this.piece),e)){switch(this.clearPiece(),e){case S.COUNTER:this.piece.rotateCounterClockwise();break;case S.WISE:this.piece.rotateClockwise();break;default:console.error("tetris: Rotation not handled",e)}this.drawPiece()}}async clearRowFrom(e){this._clearSquares(Array.from({length:f},(t,s)=>[e[0],s]))}_movePiece(e,t){switch(this.clearPiece(),t){case n.DOWN:e.boardPosition[0]+=1;break;case n.LEFT:e.boardPosition[1]-=1;break;case n.RIGHT:e.boardPosition[1]+=1;break;default:console.log("[Tetris Board] Unhandled direction",t);break}this.drawPiece()}_canMoveTo(e,t){let s;switch(t){case n.DOWN:s=e.getDownBoardPosition();break;case n.LEFT:s=e.getLeftBoardPosition();break;case n.RIGHT:s=e.getRightBoardPosition();break;default:console.log("[Tetris Board] Unhandled move direction",t);break}const o=i.getOnBoardCoordinates(s,e.squares);return!this._areOutOfBoundaries(o)&&!this._areAlreadyUsed(o)}_canRotate(e,t){switch(t){case S.COUNTER:e.rotateCounterClockwise();break;case S.WISE:e.rotateClockwise();break;default:console.error("tetris: Rotation not handled",t)}const s=i.getOnBoardCoordinates(e.boardPosition,e.squares);return!this._areOutOfBoundaries(s)&&!this._areAlreadyUsed(s)}_areOutOfBoundaries(e){for(const t of e)if(t[0]<0||t[0]>=q||t[1]<0||t[1]>=f)return!0;return!1}_areAlreadyUsed(e){for(const t of e)if(this.board[t[0]][t[1]])return!0;return!1}_clearSquares(e){for(const t of e)this.ctx.clearRect(t[1]*this.squareSide,t[0]*this.squareSide,this.squareSide,this.squareSide),this.ctx.lineWidth=v,this.ctx.strokeStyle=B,this.ctx.strokeRect(t[1]*this.squareSide,t[0]*this.squareSide,this.squareSide,this.squareSide)}_drawSquare(e,t){this.ctx.fillStyle=t,this.ctx.fillRect(e[1]*this.squareSide,e[0]*this.squareSide,this.squareSide,this.squareSide),this.ctx.strokeRect(e[1]*this.squareSide,e[0]*this.squareSide,this.squareSide,this.squareSide)}}let a;function Y(){const[h,e]=w.exports.useState(0),[t,s]=w.exports.useState(!1),o=w.exports.useRef(),r=O(b.jobs),c=O(_.scores),l=y(),x=[{text:"\u2B05\uFE0F",onClick:()=>{a.handleMove(n.LEFT)}},{text:"\u27A1\uFE0F",onClick:()=>{a.handleMove(n.RIGHT)}},{text:"\u21AA\uFE0F",onClick:()=>{a.handleRotation(S.COUNTER)}},{text:"\u21A9\uFE0F",onClick:()=>{a.handleRotation(S.WISE)}},{text:"\u23EC",onClick:()=>{a.handleMove(n.DOWN),a.handleMove(n.DOWN)}}],P=d=>{l(T.createScore(d))},R=()=>{a.drawBoard(),r.length&&a.drawTimeline(r)},I=()=>{a.eraseBoard(),a.drawBoard(),a.startGame(),s(!0)},p=()=>{a.stopGame(),a.eraseBoard(),R(),s(!1)};return w.exports.useEffect(()=>(c.length||l(T.getScores()),p),[]),w.exports.useEffect(()=>{const d=o.current;a=new H(d,{setScore:e,updateRanking:P}),R()},[r]),m("div",{id:"tetris-canvas",children:[u("canvas",{ref:o,width:300,height:600}),t&&m(N.Fragment,{children:[u("div",{className:"control-container row center-xs",children:x.map(d=>u("div",{className:"control m-x",onClick:d.onClick,children:d.text},d.text))}),m("div",{className:"row center-xs",children:["Score: ",h]}),u("div",{className:"row center-xs m-t",children:u(k,{variant:"outlined",onClick:p,children:"Stop game"})})]}),!t&&u("div",{className:"row center-xs m-t",children:u(k,{variant:"outlined",onClick:I,children:"Start game"})})]})}export{Y as default};
